services:
  dev:
    image:  logger-dev:latest 
    build:
      context: .
      dockerfile: DevOps/HwDev/Docker/Dockerfile
    privileged: true
    environment:
      - DISPLAY=${DISPLAY}   # Forward the host's display
    stdin_open: true  # Keep stdin open for interaction
    tty: true         # Allocate a TTY for interactive Bash
    volumes:
      - ./Software:/workspace/Software
      - ./Simulation:/workspace/Simulation
      - ./Test:/workspace/Test
      - ./DevOps/HwDev/BuildArtifacts:/workspace/build/BuildArtifacts
      - ./CMakeLists.txt:/workspace/CMakeLists.txt
      - /tmp/.X11-unix:/tmp/.X11-unix   # Mount X server socket
    working_dir: /workspace
    # Do not override the CMD from Dockerfile

  raspberry-logger:
    image: raspberry-logger:latest
    build:
      context: .
      dockerfile: DevOps/Docker/Dockerfile.pi
    #environment:
    #  - PYTHONUNBUFFERED=1
    volumes:
      - ./Software:/workspace/Software
    ports:
      - "3000:3000"  # Map Grafana's internal port 3000 to the host
      - "8086:8086"  # InfluxDB
    #depends_on:
    #  - dev
    restart: unless-stopped
